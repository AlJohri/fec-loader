#!/usr/bin/env node
// jshint esnext:true

var models = require('@publici/fec-model')({
    driver: 'postgres',
    name: process.env.PGDATABASE,
    user: process.env.PGUSER,
    pass: process.env.PGPASSWORD,
    host: process.env.PGHOST,
    port: process.env.PGPORT
});

const lookBehind = 1000,
    lookAhead = 10;

models.fec_filing.findAll({
        attributes: ['filing_id'],
        limit: lookBehind,
        where: {
            filing_id: {
                $lt: 5000000
            }
        },
        order: [
            ['filing_id', 'DESC']
        ]
    })
    .then(filings => {
        models.sequelize.close();

        filings = filings.map(filing => filing.filing_id);

        let tasks = [];

        for (let i = filings[0]-lookBehind; i <= filings[0] + lookAhead; i++) {
            if (!filings.includes(i)) {
                tasks.push(i);
            }
        }

        tasks = tasks.map(task => `http://docquery.fec.gov/dcdev/posted/${task}.fec`);

        console.log(tasks.join('\n'));
    })
    .catch(err => {
        console.error(err);
    });
